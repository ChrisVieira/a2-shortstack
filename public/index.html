<!DOCTYPE html>
<html lang="en">
  <head>
    <title>CS4241 Assignment 2</title>
    <meta charets="utf-8" />
  </head>
  <body>
    <form action="">
      <input type="text" id="StudentName" value="Enter Name Here" />
      <input type="text" id="StudentClass" value="Enter Course Here" />
      <select id="StudentRole">
        <option>SA</option>
        <option>TA</option>
      </select>
      <button>Add Entry</button>
    </form>
  </body>
  <script>
    let previous_app_data = [];

    update_based_on_existing_data();

    const addItemFunc = function (e) {
      // prevent default form action from being carried out
      e.preventDefault();

      const name_input = document.querySelector("#StudentName"),
        class_input = document.querySelector("#StudentClass"),
        role_input = document.querySelector("#StudentRole"),
        json = {
          StudentName: name_input.value,
          StudentClass: class_input.value,
          StudentRole: role_input.value,
        },
        body = JSON.stringify(json);

      console.log("json");
      console.log(json);

      fetch("/submit", {
        method: "POST",
        body,
      })
        .then(function (response) {
          return response.json();
        })
        .then(function (data) {
          initialize_list(data);

          previous_app_data = data;

          return data;
        });

      return false;
    };

    function update_based_on_existing_data() {
      fetch("/initializeData", {
        method: "GET",
      })
        .then(function (response) {
          return response.json();
        })
        .then(function (data) {
          initialize_list(data);

          previous_app_data = data;

          return data;
        });

      return false;
    }

    function deleteItemFunc(button) {
      const input = button.path[0].id,
        json = { id: input },
        body = JSON.stringify(json);

      fetch("/deleteEntry", {
        method: "POST",
        body,
      })
        .then(function (response) {
          return response.json();
        })
        .then(function (data) {
          initialize_list(data);

          previous_app_data = data;

          return data;
        });

      return false;
    }

    function updateItemFunc(button) {
      const name_input = document.querySelector("#StudentName"),
        class_input = document.querySelector("#StudentClass"),
        role_input = document.querySelector("#StudentRole"),
        id_value = button.path[0].id,
        json = {
          StudentName: name_input.value,
          StudentClass: class_input.value,
          StudentRole: role_input.value,
          id: id_value,
        },
        body = JSON.stringify(json);

      fetch("/updateEntry", {
        method: "POST",
        body,
      })
        .then(function (response) {
          return response.json();
        })
        .then(function (data) {
          initialize_list(data);

          previous_app_data = data;

          return data;
        });

      return false;
    }

    function initialize_list(data_points) {
      var forum_section = document.getElementById("forum_section");

      if (forum_section != null) {
        forum_section.remove();
      }

      const element = document.createElement("ul");
      element.setAttribute("id", "forum_section");

      function myFunc(data_point) {
        const element_list_item = document.createElement("li");
        const element_list_delete = document.createElement("BUTTON");
        const element_list_update = document.createElement("BUTTON");

        element_list_item.innerHTML =
          data_point.StudentName +
          " --- " +
          data_point.StudentClass +
          " --- " +
          data_point.StudentRole +
          " --- " +
          data_point.StudentHours;

        element_list_delete.setAttribute("id", data_point.id);
        element_list_delete.innerHTML = "remove_item";
        element_list_update.setAttribute("id", data_point.id);
        element_list_update.innerHTML = "update_item";

        element_list_delete.onclick = deleteItemFunc;
        element_list_update.onclick = updateItemFunc;

        element.appendChild(element_list_item);
        element.appendChild(element_list_delete);
        element.appendChild(element_list_update);
        document.body.appendChild(element);
      }

      data_points.forEach(myFunc);
    }

    window.onload = function () {
      const button = document.querySelector("button");
      button.onclick = addItemFunc;
    };
  </script>
</html>
