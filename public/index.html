<!DOCTYPE html>
<html lang="en">
  <head>
    <title>CS4241 Assignment 2</title>
    <meta charset="utf-8" />
  </head>
  <body>
    <form action="">
      <input type="text" id="yourname" value="your name here" />
      <button>submit</button>
    </form>
    <!-- <ul id="trackedForm">
      <li>TestingText</li>
    </ul> -->
  </body>
  <script>
    let previous_app_data = [];

    update_based_on_existing_data();

    const submit = function (e) {
      // prevent default form action from being carried out
      e.preventDefault();

      const input = document.querySelector("#yourname"),
        json = { yourname: input.value },
        body = JSON.stringify(json);

      // console.log("This is the index.html")
      // console.log("This is the input:")
      // console.log(input)
      // console.log("This is the json:")
      // console.log(json)
      // console.log("This is the body:")
      // console.log(body)

      fetch("/submit", {
        method: "POST",
        body,
      })
        .then(function (response) {
          // do something with the response
          // console.log("response")
          // console.log( response )
          // console.log("response string")
          // console.log( response.toString() )
          // console.log("response body")
          // console.log(response.text())
          // console.log("JSON parsed response body")
          // console.log(JSON.parse(response.body))
          // console.log("JSON toString")
          // console.log(response.toString())
          // console.log("Response Body")
          // console.log(response.body)
          // console.log("Response Text")
          // console.log(response.responseText)
          // console.log(response)
          // console.log("yourname")
          // console.log(json.yourname)
          // return json.yourname
          return response.json();
        })
        .then(function (data) {
          // const string_json = json
          // console.log("new data")
          // console.log(data)

          initialize_list(data);

          // console.log(element)

          // console.log("previous_app_data")
          // console.log(previous_app_data)
          previous_app_data = data;
          // console.log("updated data")
          // console.log(previous_app_data)

          // element.appendChild(document.createElement('ul').innerHTML = "testing")
          // document.getElementById("forum_section").appendChild(document.createElement('ul').innerHTML = "testing")

          return data;
        });

      return false;
    };

    function update_based_on_existing_data() {
      fetch("/initializeData", {
        method: "GET",
      })
        .then(function (response) {
          return response.json();
        })
        .then(function (data) {
          initialize_list(data);

          previous_app_data = data;

          return data;
        });

      return false;
    }

    function deleteItemFunc(button) {
      // console.log(button.path[0].id);

      const input = button.path[0].id,
        json = { id: input },
        body = JSON.stringify(json);

      // console.log("Body")
      // console.log(body)

      fetch("/deleteEntry", {
        method: "POST",
        body,
      })
        .then(function (response) {
          return response.json();
        })
        .then(function (data) {

          initialize_list(data);

          previous_app_data = data;

          return data;
        });

      return false;
    }

    function initialize_list(data_points) {
      var forum_section = document.getElementById("forum_section");
      // console.log("forum_section")
      // console.log(forum_section)
      if (forum_section != null) {
        // console.log("Attempting to remove")
        forum_section.remove();
      }

      const element = document.createElement("ul");
      element.setAttribute("id", "forum_section");
      // element.innerHTML = '<p><h1>text</h1></p>'
      // element.innerHTML = '<p><h1>' + data.toString() + '</h1></p>'
      // element.innerHTML = data
      // console.log("Loop")
      function myFunc(data_point) {
        // console.log(data_point.name);
        const element_list_item = document.createElement("li");
        const element_list_delete = document.createElement("BUTTON");
        const delete_button_id = data_point.id;
        element_list_delete.setAttribute("id", delete_button_id);
        element_list_delete.setAttribute("name", "your name here");
        element_list_item.innerHTML = data_point.name;
        element_list_delete.innerHTML = "remove_item";

        element_list_delete.onclick = deleteItemFunc;

        element.appendChild(element_list_item);
        element.appendChild(element_list_delete);
        document.body.appendChild(element);
      }
      data_points.forEach(myFunc);
    }

    window.onload = function () {
      const button = document.querySelector("button");
      button.onclick = submit;
    };
  </script>
</html>
